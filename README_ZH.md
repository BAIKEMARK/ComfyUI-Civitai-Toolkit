# Civitai Recipe Finder (Civitai é…æ–¹æŸ¥æ‰¾å™¨)

## åŠŸèƒ½è¯´æ˜

è¦åˆ›ä½œå‡ºæƒŠè‰³çš„ AI è‰ºæœ¯ä½œå“ï¼Œå…³é”®åœ¨äºæ‰¾åˆ°å®Œç¾çš„â€œ**é…æ–¹ (Recipe)**â€â€”â€”å³æ¨¡å‹ã€è§¦å‘è¯ã€æç¤ºè¯å’Œç”Ÿæˆå‚æ•°çš„ç†æƒ³ç»„åˆã€‚**Civitai Recipe Finder** æ˜¯ä¸€å¥—ä¸º ComfyUI è®¾è®¡çš„å¼ºå¤§èŠ‚ç‚¹å·¥å…·é›†ï¼Œæ—¨åœ¨é€šè¿‡æ·±åº¦åˆ†æ Civitai ç¤¾åŒºæ•°æ®æˆ–ä¸ºæ‚¨æœ¬åœ°æ¨¡å‹æä¾›å³æ—¶è§†è§‰åé¦ˆï¼Œå¸®ä½ æ­ç¤ºè¿™äº›åˆ›ä½œé…æ–¹ã€‚

æœ¬èŠ‚ç‚¹å¥—ä»¶æä¾›å¤šç»´åº¦çš„æ–¹å¼æ¥æ¢ç´¢åˆ›ä½œé…æ–¹ï¼š

  * **å¯è§†åŒ–æŸ¥æ‰¾é…æ–¹**: é€‰æ‹©ä¸€ä¸ªæœ¬åœ°æ¨¡å‹ï¼Œå³æ—¶æµè§ˆå…¶åœ¨ç¤¾åŒºçš„çƒ­é—¨ä½œå“ç”»å»Šã€‚åªéœ€å•å‡»ï¼Œå³å¯åº”ç”¨å®Œæ•´é…æ–¹â€”â€”åŒ…æ‹¬æç¤ºè¯ã€å‚æ•°å’Œ LoRA ç»„åˆï¼Œç”šè‡³æ”¯æŒä¸€é”®åŠ è½½å·¥ä½œæµã€‚
  * **å³æ—¶æŸ¥æ‰¾è§¦å‘è¯**: å¿«é€Ÿè·å–ä»»ä½• LoRA æ¨¡å‹çš„å®˜æ–¹æ¨èè§¦å‘è¯å’Œå…ƒæ•°æ®è§¦å‘è¯ã€‚
  * **å‘ç°ç¤¾åŒºè¶‹åŠ¿**: åˆ†ææ•°ç™¾å¼ ç¤¾åŒºå›¾ç‰‡ï¼Œæ‰¾åˆ°ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„æ­£ã€è´Ÿå‘æç¤ºè¯ã€‚
  * **æ­ç¤ºæœ€ä½³å‚æ•°**: è¯†åˆ«ç¤¾åŒºé’ˆå¯¹ç‰¹å®šæ¨¡å‹æœ€å¸¸ç”¨çš„ç”Ÿæˆå‚æ•°ï¼ˆé‡‡æ ·å™¨ã€CFGã€æ­¥æ•°ç­‰ï¼‰ã€‚
  * **å‘æ˜â€œé»„é‡‘ç»„åˆâ€**: å‘ç°å“ªäº›å…¶ä»–çš„ LoRA æ¨¡å‹æœ€å¸¸ä¸ä½ é€‰æ‹©çš„æ¨¡å‹æ­é…ä½¿ç”¨ã€‚

æ•´ä¸ªå¥—ä»¶åŸºäºæ¨¡å—åŒ–çš„è®¾è®¡å“²å­¦ï¼Œè®©æ‚¨æ—¢èƒ½è¿›è¡Œå¿«é€Ÿçš„è§†è§‰æŸ¥æ‰¾ï¼Œä¹Ÿèƒ½æ„å»ºå¤æ‚æ·±åº¦çš„åˆ†æå·¥ä½œæµï¼ŒåŒæ—¶ç¡®ä¿äº†æœ€é«˜æ•ˆç‡ã€‚

## èŠ‚ç‚¹å¥—ä»¶è¯´æ˜

Recipe Finder ç”±ä¸‰ç»„ç‹¬ç«‹çš„å·¥å…·æ„æˆï¼Œä»¥åŒ¹é…æ‚¨çš„ä¸åŒéœ€æ±‚ã€‚

### 1\. å¯è§†åŒ–é…æ–¹æŸ¥æ‰¾å™¨ (Visual Recipe Finder)

#### `Civitai Recipe Gallery` (Civitai é…æ–¹ç”»å»Š)

  - **ç”¨é€”**: é€‰æ‹©ä¸€ä¸ªæœ¬åœ°æ¨¡å‹ï¼Œå¯è§†åŒ–æµè§ˆç¤¾åŒºçš„çƒ­é—¨èŒƒä¾‹ï¼Œå¹¶å¿«é€Ÿå¤ç°å®Œæ•´é…æ–¹ã€‚
  - **ã€æ–°å¢åŠŸèƒ½ã€‘**:
      - **ã€ä¸€é”®åŠ è½½å·¥ä½œæµã€‘**: èŠ‚ç‚¹ä¸Šçš„ â€œğŸš€ Load Workflowâ€ æŒ‰é’®å¯ä»¥å³æ—¶ã€å®‰å…¨åœ°åŠ è½½å›¾ç‰‡çš„åŸå§‹å·¥ä½œæµã€‚å®ƒè¶³å¤Ÿæ™ºèƒ½ï¼Œå¦‚æœæ£€æµ‹åˆ°æ‚¨å®‰è£…äº†ComfyUI-Managerï¼Œä¼šè‡ªåŠ¨**åœ¨æ–°çš„å·¥ä½œæµæ ‡ç­¾é¡µä¸­åŠ è½½**ï¼Œä¿æŠ¤æ‚¨å½“å‰çš„å·¥ä½œã€‚
      - **ã€ä¿å­˜æºæ–‡ä»¶ã€‘**: èŠ‚ç‚¹ä¸Šçš„ â€œğŸ’¾ Save Originalâ€ æŒ‰é’®ï¼Œå¯ä»¥å°†**åŒ…å«å®Œæ•´å·¥ä½œæµå…ƒæ•°æ®**çš„ã€æœªç»ä¿®æ”¹çš„åŸå§‹å›¾ç‰‡ï¼Œä¸‹è½½åˆ°æ‚¨çš„ComfyUI `output` æ–‡ä»¶å¤¹ä¸­ï¼Œæ–¹ä¾¿å½’æ¡£ã€‚
  - **è¾“å…¥**: `model_name`, `sort`, `nsfw_level`, `image_limit`
  - **è¾“å‡º**:

| è¾“å‡ºç«¯å£ | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| `image` | `IMAGE` | æ‰€é€‰çš„èŒƒä¾‹å›¾ç‰‡ï¼Œç”¨äºåœ¨å½“å‰å·¥ä½œæµä¸­é¢„è§ˆæˆ–è¿›è¡Œå†å¤„ç†ã€‚ |
| `info_md` | `STRING` | **å”¯ä¸€çš„ã€ç»Ÿä¸€çš„æŠ¥å‘Š**ã€‚ç”¨äºç†è§£é…æ–¹çš„æ‰€æœ‰å‚æ•°ä»¥åŠæ‚¨æœ¬åœ°LoRAçš„æŒæœ‰çŠ¶æ€ã€‚è¯·è¿æ¥åˆ°`MarkdownPresenter`èŠ‚ç‚¹æŸ¥çœ‹ã€‚ |
| `recipe_params`| `RECIPE_PARAMS`| ä¸€ä¸ª**æ•°æ®ç®¡é“**ï¼ŒåŒ…å«æ‰€æœ‰æ ¸å¿ƒå‚æ•°ï¼Œç”¨äºé«˜çº§çš„è‡ªåŠ¨åŒ–å·¥ä½œæµã€‚è¯·è¿æ¥åˆ°`Recipe Params Parser`èŠ‚ç‚¹è§£åŒ…ã€‚|

> [\!NOTE]  
> âš ï¸ **é¦–æ¬¡è¿è¡Œè€—æ—¶è¯´æ˜**
>
> * åˆæ¬¡è¿è¡Œä¼šè®¡ç®—æ‰€æœ‰æœ¬åœ°æ¨¡å‹çš„ **hash**ï¼Œè€—æ—¶å¯èƒ½è¾ƒé•¿ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚
> * ç»“æœä¿å­˜åœ¨ **`Civitai_Recipe_Finder/data`** ç›®å½•ä¸‹ã€‚
> * åç»­ä»…ä¼šè®¡ç®—ç¼ºå¤±çš„æ¨¡å‹ã€‚


![gallery example](./image/gallery.png)


#### `Recipe Params Parser` (é…æ–¹å‚æ•°è§£æå™¨)

-   **ç”¨é€”**ï¼š`GalleryNode` çš„å¿…è¦é…å¥—èŠ‚ç‚¹ã€‚å®ƒèƒ½â€œè§£åŒ…â€`recipe_params`æ•°æ®ç®¡é“ï¼Œå°†å…¶è¿˜åŸä¸ºå¤šä¸ªç‹¬ç«‹çš„ã€å¯ç›´æ¥ä½¿ç”¨çš„å‚æ•°è¾“å‡ºï¼Œæ‰€æœ‰è¾“å‡ºç±»å‹éƒ½ç»è¿‡ä¿®æ­£ï¼Œå¯ç›´æ¥ä¸`KSampler`ç­‰ä¸‹æ¸¸èŠ‚ç‚¹å…¼å®¹ã€‚
-   **è¾“å…¥**: `recipe_params`
-   **è¾“å‡º**: `positive_prompt`, `negative_prompt`, `seed`, `steps`, `cfg`, `sampler_name`, `scheduler`, `ckpt_name`, `width`, `height`, `denoise`ã€‚


### 2\. è½»é‡çº§å·¥å…· (Lightweight Tool)

è¿™ä¸ªç‹¬ç«‹èŠ‚ç‚¹ä¸“ä¸ºé«˜é¢‘ã€æ—¥å¸¸ä½¿ç”¨åœºæ™¯è®¾è®¡ã€‚

#### `Lora Trigger Words` (Lora è§¦å‘è¯)

  - **ç”¨é€”**: æ— éœ€ä»»ä½•é‡åº¦å¤„ç†ï¼Œå³æ—¶è·å–ä¸€ä¸ª LoRA æ¨¡å‹çš„ä¸¤ç»„æ ¸å¿ƒè§¦å‘è¯ã€‚
  - **è¾“å…¥**: `lora_name`, `force_refresh`
  - **è¾“å‡º**:

| è¾“å‡ºç«¯å£ | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| `metadata_triggers` | `STRING` | ä»æœ¬åœ°æ–‡ä»¶å…ƒæ•°æ®æå–çš„çº¯æ–‡æœ¬è§¦å‘è¯ã€‚ |
| `civitai_triggers` | `STRING` | ä» Civitai API è·å–çš„å®˜æ–¹çº¯æ–‡æœ¬è§¦å‘è¯ã€‚ |
| **`triggers_md`** | `STRING`|ä¸€ä»½ç²¾ç¾çš„Markdownè¡¨æ ¼æŠ¥å‘Šï¼Œå¯¹æ¯”ä¸Šè¿°ä¸¤ç§æ¥æºçš„è§¦å‘è¯ã€‚è¯·è¿æ¥åˆ°`MarkdownPresenter`ã€‚|


![lora_trigger_words example](./image/lora_trigger_words.png)

### 3\. åˆ†æå™¨æµæ°´çº¿ (Analyzer Pipeline)

è¿™æ˜¯ä¸€å¥—ä¸ºæ·±åº¦æ¨¡å‹ç»Ÿè®¡åˆ†æè®¾è®¡çš„å¼ºå¤§ã€æ¨¡å—åŒ–çš„æµæ°´çº¿ã€‚

#### `Civitai Data Fetcher (CKPT / LORA)` (æ•°æ®è·å–å™¨)

  * **ç”¨é€”**: æµæ°´çº¿çš„å¼•æ“ã€‚å®ƒä¸ºæŒ‡å®šçš„æ¨¡å‹è·å–æ‰€æœ‰ç¤¾åŒºå›¾ç‰‡å…ƒæ•°æ®ï¼Œå¹¶å°†å…¶æ‰“åŒ…æˆä¸€ä¸ªæ•°æ®åŒ…è¾“å‡ºã€‚**è¿™æ˜¯æµæ°´çº¿ä¸­å”¯ä¸€è¿›è¡Œé‡åº¦ç½‘ç»œè¯·æ±‚çš„èŠ‚ç‚¹ã€‚**
  * **è¾“å…¥**: `model_name`, `max_pages`, `sort`, `retries`, `timeout`, `force_refresh`
  * **è¾“å‡º**: `civitai_data` (æ•°æ®åŒ…), `fetch_summary` (STRING)ã€‚

#### `Prompt Analyzer` (æç¤ºè¯åˆ†æå™¨), `Parameter Analyzer` (å‚æ•°åˆ†æå™¨), `Resource Analyzer` (å…³è”èµ„æºåˆ†æå™¨)

  - **ç”¨é€”**: è¿™äº›èŠ‚ç‚¹è¿æ¥åˆ°è·å–å™¨çš„`civitai_data`è¾“å‡ºè¿›è¡Œä¸“é¡¹åˆ†æã€‚**ã€å®ƒä»¬çš„æ ¸å¿ƒåŠŸèƒ½æ˜¯ç”Ÿæˆæ¸…æ™°æ˜“è¯»çš„åˆ†ææŠ¥å‘Šã€‚ã€‘**
  - **è¾“å‡º**:
      - æ‰€æœ‰ä¸‰ä¸ªåˆ†æå™¨ç°åœ¨éƒ½æœ‰ä¸€ä¸ª**å•ä¸€çš„ã€ä¸»è¦çš„MarkdownæŠ¥å‘Šè¾“å‡º** (`..._report_md`)ã€‚è¯·å°†æ­¤ç«¯å£è¿æ¥åˆ° `Markdown Presenter` èŠ‚ç‚¹æ¥æŸ¥çœ‹åˆ†æç»“æœã€‚
      - ä¸ºæ–¹ä¾¿èµ·è§, `ParameterAnalyzer` é¢å¤–è¾“å‡ºäº†ä¸€å°ç»„æœ€æ ¸å¿ƒçš„å‚æ•°ï¼ˆå¦‚ `sampler`, `steps`, `cfg`ï¼‰ï¼Œå¯ç”¨äºç›´æ¥çš„æµç¨‹è‡ªåŠ¨åŒ–ã€‚


![Fetcher-Analyzer example](./image/F-A_workflow.png)

## å®‰è£…

1.  å°†é¡¹ç›®æ–‡ä»¶å¤¹æ”¾å…¥ ComfyUI çš„ `custom_nodes` ç›®å½•ï¼Œä¾‹å¦‚ï¼š
    ```
    ComfyUI/custom_nodes/CivitaiProject/
    ```
2.  **å®‰è£…æ‰€æœ‰å¿…éœ€çš„ä¾èµ–é¡¹**ã€‚è¯·åœ¨æ‚¨çš„ComfyUIç¯å¢ƒçš„ç»ˆç«¯ä¸­ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
    ```bash
    pip install -r requirements.txt
    ```
3.  é‡å¯ ComfyUIã€‚ä½ å°†åœ¨ `Civitai` èœå•åŠå…¶å­èœå•ä¸­æ‰¾åˆ°æ‰€æœ‰æ–°èŠ‚ç‚¹ã€‚

> [\!TIP]  
> Markdown PresenterèŠ‚ç‚¹å¯åœ¨'Display'èœå•æ‰¾åˆ°ï¼Œæˆ–åŒå‡»æœç´¢æ¡†ä¸­è¾“å…¥'Markdown Presenter'ã€‚

## å·¥ä½œæµç¤ºä¾‹

ä¸ºæ–¹ä¾¿ä½¿ç”¨ï¼Œæä¾›äº†ä¸€ç»„å·¥ä½œæµç¤ºä¾‹ï¼Œå­˜æ”¾äºä»“åº“ç›®å½• `./workflow_examples`ï¼Œå³ [ComfyUI-Civitai-Recipe/workflow\_examples](./workflow_examples)ã€‚


## å¯¹äºå›½å†…ç”¨æˆ·çš„æ”¯æŒ

ä¸ºä¿éšœå›½å†…äº’è”ç½‘ç¯å¢ƒä¸‹çš„ç”¨æˆ·ä¹Ÿèƒ½æ­£å¸¸ä½¿ç”¨è¯¥è‡ªå®šä¹‰èŠ‚ç‚¹ï¼Œåœ¨è®¾ç½®ä¸­åŠ å…¥äº† **`Civitai Helper Network`**ï¼Œç”¨äºé€‰æ‹©è®¿é—® Civitai æ—¶æ‰€ä½¿ç”¨çš„ç½‘ç»œç¯å¢ƒã€‚

  * å¯¹äºä¸­å›½ç”¨æˆ·ï¼Œå¯é€‰æ‹© **`China Mirror`**ï¼ˆå›½å†…å®˜æ–¹é•œåƒï¼‰ä»¥æ›´å¿«ã€æ›´ç¨³å®šåœ°è®¿é—® Civitaiã€‚
  * é»˜è®¤é€‰é¡¹ä¸º **`International`**ï¼Œé€‚ç”¨äºå›½é™…äº’è”ç½‘ç¯å¢ƒç”¨æˆ·ã€‚
  * è·¯å¾„ï¼š`Settings` â†’ `CivitaiUtils` â†’ `Civitai Helper Network`ã€‚

![Network_setting](./image/Network_setting.png)

## é¸£è°¢

æœ¬é¡¹ç›®åœ¨å¼€å‘è¿‡ç¨‹ä¸­å‚è€ƒå¹¶å€Ÿé‰´äº†ä»¥ä¸‹ä¼˜ç§€å¼€æºé¡¹ç›®ï¼š

* è·å–è§¦å‘è¯çš„é€»è¾‘ï¼Œçµæ„Ÿä¸éƒ¨åˆ†ä»£ç å®ç°æ¥æºäº [Extraltodeus/LoadLoraWithTags](https://github.com/Extraltodeus/LoadLoraWithTags) ä¸ [idrirap/ComfyUI-Lora-Auto-Trigger-Words](https://github.com/idrirap/ComfyUI-Lora-Auto-Trigger-Words)ã€‚
* ç”»å»ŠèŠ‚ç‚¹çš„è®¾è®¡æ€è·¯å‚è€ƒäº† [Firetheft/ComfyUI\_Civitai\_Gallery](https://github.com/Firetheft/ComfyUI_Civitai_Gallery)ã€‚

åœ¨æ­¤å‘ä»¥ä¸Šé¡¹ç›®åŠå…¶ä½œè€…ä»¬è‡´ä»¥è¯šæŒšçš„æ„Ÿè°¢ï¼

---